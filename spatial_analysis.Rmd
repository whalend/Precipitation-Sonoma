---
title: "Spatial Exploration Analysis"
author: "Whalen Dillon"
date: "September 24, 2015"
output: html_document
---

The "spatial.RData" has spatial points data frames and data frames with daily and monthly precipitation data for each station.
```{r load data}
load("analysis201511.RData")
```
```{r load libraries, echo=FALSE, message=FALSE}
library(plyr); library(ggplot2); library(rgdal); library(dplyr); 
library(tidyr); library(rgeos); library(maptools)
```

Generate a wide formatted data frame of monthly precipitation totals (in millimeters) for each station, i.e.:
station|nov03|dec03
---|---|---
annadel|100|80
beltane|50|60

```{r create wide data frame}
monthly

wide_monthly <- ungroup(monthly) %>% 
      select(stationid, date, monthly_ppt_mm) %>%
      filter(date >= "2003-11-01" & date <= "2014-05-01") %>% 
      spread(date, monthly_ppt_mm)
wide_monthly
names(wide_monthly)

names(wide_monthly)[2:ncol(wide_monthly)] <- c(
      "ppt_nov03","ppt_dec03",
      "ppt_jan04","ppt_feb04","ppt_mar04","ppt_apr04","ppt_may04","ppt_jun04","ppt_jul04","ppt_aug04","ppt_sep04","ppt_oct04","ppt_nov04","ppt_dec04",
      "ppt_jan05","ppt_feb05","ppt_mar05","ppt_apr05","ppt_may05","ppt_jun05","ppt_jul05","ppt_aug05","ppt_sep05","ppt_oct05","ppt_nov05","ppt_dec05",
      "ppt_jan06","ppt_feb06","ppt_mar06","ppt_apr06","ppt_may06","ppt_jun06","ppt_jul06","ppt_aug06","ppt_sep06","ppt_oct06","ppt_nov06","ppt_dec06",
      "ppt_jan07","ppt_feb07","ppt_mar07","ppt_apr07","ppt_may07","ppt_jun07","ppt_jul07","ppt_aug07","ppt_sep07","ppt_oct07","ppt_nov07","ppt_dec07",
      "ppt_jan08","ppt_feb08","ppt_mar08","ppt_apr08","ppt_may08","ppt_jun08","ppt_jul08","ppt_aug08","ppt_sep08","ppt_oct08","ppt_nov08","ppt_dec08",
      "ppt_jan09","ppt_feb09","ppt_mar09","ppt_apr09","ppt_may09","ppt_jun09","ppt_jul09","ppt_aug09","ppt_sep09","ppt_oct09","ppt_nov09","ppt_dec09",
      "ppt_jan10","ppt_feb10","ppt_mar10","ppt_apr10","ppt_may10","ppt_jun10","ppt_jul10","ppt_aug10","ppt_sep10","ppt_oct10","ppt_nov10","ppt_dec10",
      "ppt_jan11","ppt_feb11","ppt_mar11","ppt_apr11","ppt_may11","ppt_jun11","ppt_jul11","ppt_aug11","ppt_sep11","ppt_oct11","ppt_nov11","ppt_dec11",
      "ppt_jan12","ppt_feb12","ppt_mar12","ppt_apr12","ppt_may12","ppt_jun12","ppt_jul12","ppt_aug12","ppt_sep12","ppt_oct12","ppt_nov12","ppt_dec12",
      "ppt_jan13","ppt_feb13","ppt_mar13","ppt_apr13","ppt_may13","ppt_jun13","ppt_jul13","ppt_aug13","ppt_sep13","ppt_oct13","ppt_nov13","ppt_dec13",
      "ppt_jan14","ppt_feb14","ppt_mar14","ppt_apr14","ppt_may14")
wide_monthly
```
 
Join monthly totals to spatial data frames that cover multiple years
```{r read in spatial data frames}
stations_0308 <- readOGR("shapefiles", "RainGauges2003_2008")
stations_0911 <- readOGR("shapefiles", "RainGauges2009_2011")
stations_1214 <- readOGR("shapefiles", "RainGauges2012_2014")

stations_0308@data <- stations_0308@data %>% 
      select(-NUM) %>% rename(station = NAME, lat_utm = NORTHING, lon_utm = EASTING)
stations_0308$station <- tolower(stations_0308$station)
stations_0308@data$station[stations_0308@data$station=="macki"] <- "mackie"
stations_0308@data$station[stations_0308@data$station=="sdc"] <- "sec"
stations_0308@data$station[stations_0308@data$station=="sugar"] <- "sugarloaf"


stations_0911@data <- stations_0911@data %>% 
      select(-NUM) %>% rename(station = NAME, lat_utm = NORTHING, lon_utm = EASTING)
stations_0911$station <- tolower(stations_0911$station)
stations_0911@data$station[stations_0911@data$station=="macki"] <- "mackie"
stations_0911@data$station[stations_0911@data$station=="sdc"] <- "sec"
stations_0911@data$station[stations_0911@data$station=="sugar"] <- "sugarloaf"


stations_1214@data <- stations_1214@data %>% 
      select(-NUM) %>% rename(station = NAME, lat_utm = NORTHING, lon_utm = EASTING)
stations_1214$station <- tolower(stations_1214$station)
stations_1214@data$station[stations_1214@data$station=="macki"] <- "mackie"
stations_1214@data$station[stations_1214@data$station=="sdc"] <- "sec"
stations_1214@data$station[stations_1214@data$station=="sugar"] <- "sugarloaf"

glen_ellen_rg <- readOGR("shapefiles", "GlenEllen_ppt_2009_2015")
summary(glen_ellen_rg)

prj <- proj4string(stations_1214)

glen_ellen_rg <- spTransform(glen_ellen_rg, CRSobj = prj)
stations_0308 <- spTransform(stations_0308, CRSobj = prj)
stations_0911 <- spTransform(stations_0911, CRSobj = prj)

glen_ellen_rg@data$lon <- glen_ellen_rg@coords[,1]
glen_ellen_rg@data$lat <- glen_ellen_rg@coords[,2]
glen_ellen_rg@data <- glen_ellen_rg@data %>% 
      rename(lat_utm = lat, lon_utm = lon)

summary(glen_ellen_rg)
summary(stations_0911)
summary(stations_1214)

stations_0911 <- spRbind(stations_0911, glen_ellen_rg)
stations_1214 <- spRbind(stations_1214, glen_ellen_rg[, c("station", "lat_utm", "lon_utm")])
```

```{r join data}
summary(stations_0308)
stations_0308@data <- left_join(stations_0308@data, select(wide_monthly, id, ppt_nov03:ppt_may08), by = c("station" = "id"))
summary(stations_0308)

summary(stations_0911)
stations_0911@data <- left_join(stations_0911@data, select(wide_monthly, id, ppt_jun08:ppt_may11), by = c("station" = "id"))
summary(stations_0911)

summary(stations_1214)
stations_1214@data <- left_join(stations_1214@data, select(wide_monthly, id, ppt_jun11:ppt_may14), by = c("station" = "id"))
summary(stations_1214)
```

#### Rain Gauge Distance to Coast
```{r calculate distance to coast}
library(rgeos)
cal_bnd <- readOGR("shapefiles/", "ca_border", verbose = F)
pac_coast <- readOGR("shapefiles/", "soco_pac_coast", verbose = F)
stations_0308@data$d2pacific <- apply(gDistance(pac_coast, stations_0308, byid = T), MARGIN = 1, FUN = min)
stations_0308@data$d2coast <- apply(gDistance(cal_bnd, stations_0308, byid = T), MARGIN = 1, FUN = min)
stations_0911@data$d2pacific <- apply(gDistance(pac_coast, stations_0911, byid = T), MARGIN = 1, FUN = min)
stations_0911@data$d2coast <- apply(gDistance(cal_bnd, stations_0911, byid = T), MARGIN = 1, FUN = min)
stations_1214@data$d2pacific <- apply(gDistance(pac_coast, stations_1214, byid = T), MARGIN = 1, FUN = min)
stations_1214@data$d2coast <- apply(gDistance(cal_bnd, stations_1214, byid = T), MARGIN = 1, FUN = min)

rainy04 <- spTransform(rainy04, CRSobj = proj4string(cal_bnd))
rainy05 <- spTransform(rainy05, CRSobj = proj4string(cal_bnd))
rainy06 <- spTransform(rainy06, CRSobj = proj4string(cal_bnd))
rainy07 <- spTransform(rainy07, CRSobj = proj4string(cal_bnd))
rainy08 <- spTransform(rainy08, CRSobj = proj4string(cal_bnd))
rainy09 <- spTransform(rainy09, CRSobj = proj4string(cal_bnd))
rainy10 <- spTransform(rainy10, CRSobj = proj4string(cal_bnd))
rainy11 <- spTransform(rainy11, CRSobj = proj4string(cal_bnd))
rainy12 <- spTransform(rainy12, CRSobj = proj4string(cal_bnd))
rainy14 <- spTransform(rainy14, CRSobj = proj4string(cal_bnd))

rainy04@data$d2pacific <- apply(gDistance(pac_coast, rainy04, byid = T), MARGIN = 1, FUN = min)
rainy05@data$d2pacific <- apply(gDistance(pac_coast, rainy05, byid = T), MARGIN = 1, FUN = min)
rainy06@data$d2pacific <- apply(gDistance(pac_coast, rainy06, byid = T), MARGIN = 1, FUN = min)
rainy07@data$d2pacific <- apply(gDistance(pac_coast, rainy07, byid = T), MARGIN = 1, FUN = min)
rainy08@data$d2pacific <- apply(gDistance(pac_coast, rainy08, byid = T), MARGIN = 1, FUN = min)
rainy09@data$d2pacific <- apply(gDistance(pac_coast, rainy09, byid = T), MARGIN = 1, FUN = min)
rainy10@data$d2pacific <- apply(gDistance(pac_coast, rainy10, byid = T), MARGIN = 1, FUN = min)
rainy11@data$d2pacific <- apply(gDistance(pac_coast, rainy11, byid = T), MARGIN = 1, FUN = min)
rainy12@data$d2pacific <- apply(gDistance(pac_coast, rainy12, byid = T), MARGIN = 1, FUN = min)
rainy14@data$d2pacific <- apply(gDistance(pac_coast, rainy14, byid = T), MARGIN = 1, FUN = min)

rainy04@data$d2coast <- apply(gDistance(cal_bnd, rainy04, byid = T), MARGIN = 1, FUN = min)
rainy05@data$d2coast <- apply(gDistance(cal_bnd, rainy05, byid = T), MARGIN = 1, FUN = min)
rainy06@data$d2coast <- apply(gDistance(cal_bnd, rainy06, byid = T), MARGIN = 1, FUN = min)
rainy07@data$d2coast <- apply(gDistance(cal_bnd, rainy07, byid = T), MARGIN = 1, FUN = min)
rainy08@data$d2coast <- apply(gDistance(cal_bnd, rainy08, byid = T), MARGIN = 1, FUN = min)
rainy09@data$d2coast <- apply(gDistance(cal_bnd, rainy09, byid = T), MARGIN = 1, FUN = min)
rainy10@data$d2coast <- apply(gDistance(cal_bnd, rainy10, byid = T), MARGIN = 1, FUN = min)
rainy11@data$d2coast <- apply(gDistance(cal_bnd, rainy11, byid = T), MARGIN = 1, FUN = min)
rainy12@data$d2coast <- apply(gDistance(cal_bnd, rainy12, byid = T), MARGIN = 1, FUN = min)
rainy14@data$d2coast <- apply(gDistance(cal_bnd, rainy14, byid = T), MARGIN = 1, FUN = min)
```


```{r seasonal rain gauge PRISM correlation}
rs04 <- select(rainy04@data, station, lat, lon, elev_m, totppt_mm, psm_totppt, starts_with("d2")) %>% mutate(year = 2004)
rs05 <- select(rainy05@data, station, lat, lon, elev_m, totppt_mm, psm_totppt, starts_with("d2")) %>% mutate(year = 2005)
rs06 <- select(rainy06@data, station, lat, lon, elev_m, totppt_mm, psm_totppt, starts_with("d2")) %>% mutate(year = 2006)
rs07 <- select(rainy07@data, station, lat, lon, elev_m, totppt_mm, psm_totppt, starts_with("d2")) %>% mutate(year = 2007)
rs08 <- select(rainy08@data, station, lat, lon, elev_m, totppt_mm, psm_totppt, starts_with("d2")) %>% mutate(year = 2008)
rs09 <- select(rainy09@data, station, lat, lon, elev_m, totppt_mm, psm_totppt, starts_with("d2")) %>% mutate(year = 2009)
rs10 <- select(rainy10@data, station, lat, lon, elev_m, totppt_mm, psm_totppt, starts_with("d2")) %>% mutate(year = 2010)

rs_totals <- rbind(rs04, rs05, rs06, rs07, rs08, rs09, rs10)

ggplot(data = rs_totals, aes(x = psm_totppt, y = totppt_mm)) +
      geom_point(aes(color = as.factor(year)), size = 5) +
      xlab("PRISM precipitation (mm)") +
      ylab("Rain gauge precipitation (mm)") +
      ggtitle("Rainy Season Rain Gauge Precipitation vs. PRISM Precipiation")
cor(rs_totals$psm_totppt, rs_totals$totppt_mm)

correlations <- select(rs_totals, totppt_mm, psm_totppt, year) %>% 
      group_by(year) %>% 
      summarise(corr = round(cor(totppt_mm, psm_totppt), 2),
                avg_dev = mean(psm_totppt - totppt_mm),
                avg_abs_dev = mean(abs(psm_totppt - totppt_mm))) %>%
      mutate(label = paste("R = ", as.character(corr)))

deviation <- select(rs_totals, station, totppt_mm, psm_totppt, year) %>% 
      group_by(year, station) %>% 
      summarise(abs_dev = abs(psm_totppt - totppt_mm))
summary(deviation)

rs_totals.cor <- ggplot(data = rs_totals, aes(x = psm_totppt, y = totppt_mm))
rs_totals.cor + 
      geom_point() +
      geom_smooth(method ="lm", size = 0.5, se = F) +
      facet_grid(year ~ ., scales = "free_x", space = "free_x") +
      # scale_x_continuous(breaks = seq(500, 2000, 500)) +
      geom_text(aes(x = 1, y = 1000, label = label), data = correlations, 
                hjust = 0, vjust = 0) +
      xlab("PRISM precipitation (mm)") +
      ylab("Rain gauge precipitation (mm)") +
      ggtitle("Rainy Season Rain Gauge Precipitation vs. PRISM Precipiation") +
      theme_bw()
```

```{r add prism-rg deviation, echo=FALSE}
# summary(rainy04)
rainy04@data <- rainy04@data %>% rename(lat_utm = lat, lon_utm = lon) %>% 
      mutate(psm_rg_dev = abs(psm_totppt - totppt_mm))
# summary(rainy05)
rainy05@data <- rainy05@data %>% rename(lat_utm = lat, lon_utm = lon) %>% 
      mutate(psm_rg_dev = abs(psm_totppt - totppt_mm))
# summary(rainy06)
rainy06@data <- rainy06@data %>% rename(lat_utm = lat, lon_utm = lon) %>% 
      mutate(psm_rg_dev = abs(psm_totppt - totppt_mm))
# summary(rainy07)
rainy07@data <- rainy07@data %>% rename(lat_utm = lat, lon_utm = lon) %>% 
      mutate(psm_rg_dev = abs(psm_totppt - totppt_mm))
# summary(rainy08)
rainy08@data <- rainy08@data %>% rename(lat_utm = lat, lon_utm = lon) %>% 
      mutate(psm_rg_dev = abs(psm_totppt - totppt_mm))
# summary(rainy09)
rainy09@data <- rainy09@data %>% rename(lat_utm = lat, lon_utm = lon) %>% 
      mutate(psm_rg_dev = abs(psm_totppt - totppt_mm),
             lat_utm = rainy09@coords[,2], lon_utm = rainy09@coords[,1])
# summary(rainy10)
rainy10@data <- rainy10@data %>% rename(lat_utm = lat, lon_utm = lon) %>% 
      mutate(psm_rg_dev = abs(psm_totppt - totppt_mm),
             lat_utm = rainy10@coords[,2], lon_utm = rainy10@coords[,1])
# summary(rainy11)
rainy11@data <- rainy11@data %>% rename(lat_utm = lat, lon_utm = lon) %>% 
      mutate(lat_utm = rainy11@coords[,2], lon_utm = rainy11@coords[,1])
# summary(rainy12)
rainy12@data <- rainy12@data %>% rename(lat_utm = lat, lon_utm = lon) %>% 
      mutate(lat_utm = rainy12@coords[,2], lon_utm = rainy12@coords[,1])
# summary(rainy14)
rainy14@data <- rainy14@data %>% rename(lat_utm = lat, lon_utm = lon) %>% 
      mutate(lat_utm = rainy14@coords[,2], lon_utm = rainy14@coords[,1])
```


## Monthly precip correlation: rain gauges vs. PRISM
I added monthly rainfall totals from our rain gauges and extracted values from the downscaled PRISM surfaces into `stations_0308` and `stations_0911` data frames. I now want to convert the wide formatted monthly PRISM data to long format so that it is easier to plot across months and years using `ggplot` functionality.

```{r convert PRISM wide to long}
stations_0308
stations_0911

monthly_prism.wide <- stations_0308@data %>% 
      select(station, starts_with("prsm"))
# monthly_rg.wide <- stations_0308@data %>% select(station, starts_with("ppt"))

tmp <- head(monthly_prism.wide %>% 
                  gather(key = year, value = prism_ppt, -station)) %>%
      separate(col = year, into = c("year", "month"), sep = "_")
gsub("prsm", "20", tmp$year)

monthly_prism.long <- monthly_prism.wide %>%
      gather(key = year, value = prism_ppt, -station) %>%
      separate(col = year, into = c("year", "month"), sep = "_")
monthly_prism.long$year <- gsub("prsm", "20", monthly_prism.long$year)
```

Join the long formatted PRISM monthly data to the long formatted monthly data from our rain gauges:

```{r join long PRISM to long RG}
monthly
head(monthly_prism.long)
monthly_prism.long$date <- as.Date(
      paste(monthly_prism.long$year, 
            monthly_prism.long$month, "01", sep = "-"))

monthly$month <- months(monthly$date, abbreviate = T)
monthly_prism.long$month <- months(monthly_prism.long$date, abbreviate = T)
monthly_prism.long$year <- as.numeric(monthly_prism.long$year)

prism_rg <- left_join(
      select(monthly, id, monthly_ppt_mm, year, month, date),
      select(monthly_prism.long, station, prism_ppt, year, month),
      by = c("id" = "station", "year", "month"))
prism_rg
summary(prism_rg)
```

PRISM rainfall data only goes through 2010, so that is why there are 456 `NAs` for that column. To do the correlation I am going to drop the rows with `NA` for the PRISM data, and then omit any of the remaining rows that have `NA` for our rain gauge data when I do the correlation.

```{r monthly data corr}
summary(prism_rg)
prism_rg <- filter(prism_rg, !is.na(prism_ppt))
prism_rg <- filter(prism_rg, !is.na(monthly_ppt_mm))
str(prism_rg)
prism_rg$month <- factor(months(prism_rg$date), levels = month.name)

monthly.cor <- select(prism_rg, monthly_ppt_mm, prism_ppt, year, month, date) %>% 
      group_by(year, date, month) %>% 
      summarise(corr = round(cor(monthly_ppt_mm, prism_ppt), 2),
                avg_dev = mean(prism_ppt - monthly_ppt_mm),
                avg_abs_dev = mean(abs(prism_ppt - monthly_ppt_mm))) %>%
      mutate(label = paste("R = ", as.character(corr)))
summary(monthly.cor)
```

The `NAs` introduced into the correlatin are due to zero values for some of monthly precipitation values. Now to make a plot of the correlations by month and year.

```{r plot monthly precip correlations}
ggplot(data = prism_rg, aes(x = prism_ppt, y = monthly_ppt_mm)) +
      geom_point() +
      geom_smooth(method ="lm", size = 0.5, se = F) +
      facet_grid(month ~ year) +
      geom_text(aes(x = 200, y = 500, label = label), data = monthly.cor) +
      xlab("PRISM Precipitation (mm)") +
      ylab("Rain gauge precipitation (mm)") +
      ggtitle("Rain Gauges vs. PRISM Precipitation") +
      theme_bw()
```

```{r monthly data deviation}
monthly.dev <- prism_rg %>% group_by(id, year, date) %>% 
      summarise(abs_dev = abs(prism_ppt - monthly_ppt_mm))
```

## Tutorial: Spatial data exploration, visualization, and variogram analysis
EDA, spatial data visualization, and variogram analysis following methods in section 2.5 *Hierarchical Modeling and Analysis for Spatial Data* (p. 44). 

Tutorial from the book:

```{r tutorial EDA and visualization, echo=F, eval=F}
library(spBayes); library(classInt); library(RColorBrewer)

data("WEF.dat")
summary(WEF.dat)
# (WEF.dat[!apply(WEF.dat[,c("East_m", "North_m", "DBH_cm", "Tree_height_m", "ELEV_m")], 1, function(x)any(is.na(x))),])

WEF.dat <- (filter(WEF.dat, East_m != "NA" & North_m != "NA" & DBH_cm != "NA" & Tree_height_m != "NA" & ELEV_m != "NA"))

dbh <- WEF.dat$DBH_cm
ht <- WEF.dat$Tree_height_m
coords <- as.matrix(WEF.dat[,c("East_m", "North_m")])
plot(coords, pch = 1, cex = sqrt(dbh)/10, col = "darkgreen", xlab = "Easting (m)", ylab = "Northing (m)")
leg.vals <- round(quantile(dbh), 0)
legend("topleft", pch = 1, legend = leg.vals, col = "darkgreen", pt.cex = sqrt(leg.vals)/10, bty = "n", title = "DBH (cm)")

# Color ramp palette interpolates over given set of colors
col.br <- colorRampPalette(c("blue", "cyan", "yellow", "red"))
col.pal <- col.br(5)

fixed <- classIntervals(dbh, n = 4, style = "fixed", fixedBreaks = c(0, 12.7, 30.48, 60, max(dbh) + 1))
fixed.col <- findColours(fixed, col.pal)

plot(coords, col = fixed.col, pch = 19, cex = 0.5, 
     main = "Forestry tree size classes",
     xlab = "Easting (m)", ylab = "Northing (m)")
legend("topleft", fill = attr(fixed.col, "palette"),
       legend = c("sapling", "poletimber", "sawtimber", "large sawtimber"),
       bty = "n")
```

```{r tutorial variogram analysis, echo=F, eval=F}
library(geoR)
max.dist <- 0.25 * max(iDist(coords))
bins <- 50 # Set number of bins

# Compute omnidirectional variogram
vario.DBH <- variog(coords = coords, data = dbh, 
                    uvec = (seq(0, max.dist, length = bins)))

# Use nonlinear least squares to fit exponential variogram model
fit.DBH <- variofit(vario.DBH, ini.cov.pars = c(600, 200/-log(0.05)),
                    cov.model = "exponential", minimisation.function = "nls",
                    weights = "equal")
## estimates sill, range, nugget parameters for specified covar model
```

```{r fit tutorial variogram to OLS residuals, echo=F, eval=F}
lm.dbh <- lm(dbh ~ Species, data = WEF.dat)
summary(lm.dbh)

dbh.resid <- resid(lm.dbh)
vario.dbh.resid <- variog(coords = coords, data = dbh.resid, 
                          uvec = (seq(0, max.dist, length = bins)))
fit.dbh.resid <- variofit(vario.dbh.resid, ini.cov.pars = c(300, 200/-log(.05)), cov.model = "exponential", minimisation.function = "nls", weights = "equal")
```

```{r plot tutorial variograms, echo=F, eval=F}
par(mfrow = c(1, 2))
plot(vario.DBH, ylim = c(200, 1200), main = "DBH")
lines(fit.DBH)
abline(h = fit.DBH$nugget, col = "blue")
abline(h = fit.DBH$cov.pars[1] + fit.DBH$nugget, col = "green")
abline(v = -log(.05) * fit.DBH$cov.pars[2], col = "red3")

plot(vario.dbh.resid, ylim = c(200, 500), main = "DBH residuals")
lines(fit.dbh.resid)
abline(h = fit.dbh.resid$nugget, col = "blue")
abline(h = fit.dbh.resid$cov.pars[1] + fit.dbh.resid$nugget, col = "green")
abline(v = -log(.05) * fit.dbh.resid$cov.pars[2], col = "red3")
```

Checking for possible anisotropic patterns in spatial dependence can be done using `geoR` or `gstat` packages. The `variogram` function in `gstat` allows specification of a linear regression model within the function. It also enables conducting a variogram analysis on the residuals without needing to collect them explicitly. 

Tutorial variogram analysis using `gstat`.
```{r variogram analysis with gstat tutorial}
library(gstat)
elev_m <- WEF.dat$ELEV_m
sp.dat <- as.data.frame(cbind(dbh, ht, coords, elev_m))
coordinates(sp.dat) <- c("East_m", "North_m")
vario.DBH <- variogram(dbh ~ elev_m, data = sp.dat, cutoff = max.dist,
                       width = 5, alpha = (0:3) * 45)
fit.DBH <- fit.variogram(vario.DBH, vgm(1000, "Exp", 200/-log(.05), 600))
print(plot(vario.DBH, fit.DBH))
rm(coords); rm(fit.DBH); rm(vario.DBH); rm(fit.dbh.resid); rm(vario.dbh.resid)
rm(WEF.dat); rm(dbh); rm(dbh.resid); rm(ht); rm(sp.dat)
```

## Variogram analysis of precipitation data

#### OLS Models of precipitation
I am going to make a serious of OLS regression models of precipitation values for the rainy season and monthly aggregations. I will fit separte models for the rain gauge measurements and the estimates from the downscaled PRISM data using only elevation, latitude, and longitude as predictor variables.

```{r source panel functions, echo=F}
source("~/Documents/Rscratch/panel_cor.R")
# library(MuMIn)
# options(na.action = "na.fail")
# library(broom)
```

```{r RS 2004 OLS models, echo=F}
pairs(select(rainy04@data, totppt_mm, rain04_dys, elev_m, lat_utm, lon_utm, psm_totppt, d2coast, d2pacific),
      upper.panel = panel.cor, diag.panel = panel.hist,
      main = "2004 Rainy Season")

# pairs(select(rainy04@data, totppt_mm, rain04_dys, elev_m, lat_utm, lon_utm, psm_totppt, d2coast, d2pacific) %>% filter(rain04_dys >= 71),
#       upper.panel = panel.cor, diag.panel = panel.hist,
#       main = "2004 Rainy Season")

elev_m.sqr <- (rainy04@data$elev_m)^2
elev_m.log <- log1p(rainy04@data$elev_m)

# Total rainfall ~ elevation only models
rstot04.lm1 <- lm(totppt_mm ~ elev_m, data = rainy04)
rstot04.lm1a <- lm(totppt_mm ~ sqrt(elev_m), data = rainy04)
rstot04.lm1b <- lm(totppt_mm ~ elev_m.sqr, data = rainy04)
rstot04.lm1c <- lm(totppt_mm ~ elev_m.log, data = rainy04)
summary(rstot04.lm1)
summary(rstot04.lm1a)
summary(rstot04.lm1b)
summary(rstot04.lm1c)# best adj. R-squared = 0.023
AICc(rstot04.lm1); AICc(rstot04.lm1a); AICc(rstot04.lm1b); AICc(rstot04.lm1c)
par(mfrow=c(2,2))
plot(rstot04.lm1c)

# Rainy days ~ elevation only models
rsdys04.lm1 <- lm(sqrt(rain04_dys) ~ elev_m, data = rainy04)
rsdys04.lm1a <- lm(sqrt(rain04_dys) ~ sqrt(elev_m), data = rainy04)
rsdys04.lm1b <- lm(sqrt(rain04_dys) ~ elev_m.sqr, data = rainy04)
rsdys04.lm1c <- lm(sqrt(rain04_dys) ~ elev_m.log, data = rainy04)
summary(rsdys04.lm1)# best adj. R-squared = 0.018
summary(rsdys04.lm1a)
summary(rsdys04.lm1b)
summary(rsdys04.lm1c)
AICc(rsdys04.lm1); AICc(rsdys04.lm1a); AICc(rsdys04.lm1b); AICc(rsdys04.lm1c)
plot(rsdys04.lm1)

# Total rainfall ~ elevation + distance to coast models
rstot04.lm2 <- lm(totppt_mm ~ elev_m + d2coast, data = rainy04)
rstot04.lm2a <- lm(totppt_mm ~ sqrt(elev_m) + d2coast, data = rainy04)
rstot04.lm2b <- lm(totppt_mm ~ elev_m.sqr + d2coast, data = rainy04)
rstot04.lm2c <- lm(totppt_mm ~ elev_m.log + d2coast, data = rainy04)
summary(rstot04.lm2)
summary(rstot04.lm2a)
summary(rstot04.lm2b)
summary(rstot04.lm2c)
# All adj. R-squared values are negative

# Rainy days ~ elevation + distance to coast models
rsdys04.lm2 <- lm(sqrt(rain04_dys) ~ elev_m + d2coast, data = rainy04)
rsdys04.lm2a <- lm(sqrt(rain04_dys) ~ sqrt(elev_m) + d2coast, data = rainy04)
rsdys04.lm2b <- lm(sqrt(rain04_dys) ~ elev_m.sqr + d2coast, data = rainy04)
rsdys04.lm2c <- lm(sqrt(rain04_dys) ~ elev_m.log + d2coast, data = rainy04)
summary(rsdys04.lm2)
summary(rsdys04.lm2a)
summary(rsdys04.lm2b)
summary(rsdys04.lm2c)
# All adj. R-squared values are negative

# Total rain fall ~ elevation + distance to Pacific models
rstot04.lm3 <- lm(totppt_mm ~ elev_m + d2pacific, data = rainy04)
rstot04.lm3a <- lm(totppt_mm ~ sqrt(elev_m) + d2pacific, data = rainy04)
rstot04.lm3b <- lm(totppt_mm ~ elev_m.sqr + d2pacific, data = rainy04)
rstot04.lm3c <- lm(totppt_mm ~ elev_m.log + d2pacific, data = rainy04)
summary(rstot04.lm3)# adj. R-squared = 0.481
summary(rstot04.lm3a)# adj. R-squared = 0.468
summary(rstot04.lm3b)# adj. R-squared = 0.489 *best
summary(rstot04.lm3c)# adj. R-squared = 0.450
par(mfrow=c(2,2))
plot(rstot04.lm3b, main = "elev^2 model")
plot(rstot04.lm3, main = "elev model")
plot(rstot04.lm3c, main = "ln(elev) model")
plot(rstot04.lm3a, main = "sqrt(elev) model")

# Rainy days ~ elevation + distance to Pacific models
rsdys04.lm3 <- lm(sqrt(rain04_dys) ~ elev_m + d2pacific, data = rainy04)
rsdys04.lm3a <- lm(sqrt(rain04_dys) ~ sqrt(elev_m) + d2pacific, data = rainy04)
rsdys04.lm3b <- lm(sqrt(rain04_dys) ~ elev_m.sqr + d2pacific, data = rainy04)
rsdys04.lm3c <- lm(sqrt(rain04_dys) ~ elev_m.log + d2pacific, data = rainy04)
summary(rsdys04.lm3)# adj. R-squared = 0.068
summary(rsdys04.lm3a)
summary(rsdys04.lm3b)# best adj. R-squared = 0.074
summary(rsdys04.lm3c)
AICc(rsdys04.lm3); AICc(rsdys04.lm3a); AICc(rsdys04.lm3b); AICc(rsdys04.lm3c)
plot(rsdys04.lm3b)

rstot04.lm4 <- lm(totppt_mm ~ d2pacific, data = rainy04)
rsdys04.lm4 <- lm(rain04_dys ~ d2pacific, data = rainy04)
summary(rstot04.lm4)# indicates that model is better w/elevation
summary(rsdys04.lm4)# indicates that model is better w/elevation

# rs04psm.lm <- lm(psm_totppt ~ elev_m + lat + lon, data = rainy04)
# rs04rg_elev.lm <- lm(totppt_mm ~ elev_m, data = rainy04)
# summary(rs04rg.lm)
# dredge(rs04rg.lm, extra = c("adjR^2", "R^2"))
# summary(rs04psm.lm)
# summary(rs04rg_elev.lm)
```

```{r RS 2005 OLS models, echo=F}
pairs(select(rainy05@data, totppt_mm, rain05_dys, elev_m, lat_utm, lon_utm, psm_totppt, d2coast, d2pacific),
      upper.panel = panel.cor, diag.panel = panel.hist,
      main = "2005 Rainy Season")

elev_m.sqr <- (rainy05@data$elev_m)^2
elev_m.log <- log1p(rainy05@data$elev_m)

# Total rainfall ~ elevation only models
rstot05.lm1 <- lm(totppt_mm ~ elev_m, data = rainy05)
rstot05.lm1a <- lm(totppt_mm ~ sqrt(elev_m), data = rainy05)
rstot05.lm1b <- lm(totppt_mm ~ elev_m.sqr, data = rainy05)
rstot05.lm1c <- lm(totppt_mm ~ elev_m.log, data = rainy05)
summary(rstot05.lm1)
summary(rstot05.lm1a)
summary(rstot05.lm1b)
summary(rstot05.lm1c)
# These models all have negative adj. R-squared

# Rainy days ~ elevation only models
rsdys05.lm1 <- lm(sqrt(rain05_dys) ~ elev_m, data = rainy05)
rsdys05.lm1a <- lm(sqrt(rain05_dys) ~ sqrt(elev_m), data = rainy05)
rsdys05.lm1b <- lm(sqrt(rain05_dys) ~ elev_m.sqr, data = rainy05)
rsdys05.lm1c <- lm(sqrt(rain05_dys) ~ elev_m.log, data = rainy05)
summary(rsdys05.lm1)
summary(rsdys05.lm1a)
summary(rsdys05.lm1b)
summary(rsdys05.lm1c)
# These models all have negative adj. R-squared

# Total rainfall ~ elevation + distance to coast models
rstot05.lm2 <- lm(totppt_mm ~ elev_m + d2coast, data = rainy05)
rstot05.lm2a <- lm(totppt_mm ~ sqrt(elev_m) + d2coast, data = rainy05)
rstot05.lm2b <- lm(totppt_mm ~ elev_m.sqr + d2coast, data = rainy05)
rstot05.lm2c <- lm(totppt_mm ~ elev_m.log + d2coast, data = rainy05)
summary(rstot05.lm2)# adj. R.squared = 0.29
summary(rstot05.lm2a)# adj. R-squared = 0.287
summary(rstot05.lm2b)# adj. R-squared = 0.288
summary(rstot05.lm2c)# adj. R-squared = 0.282

# Rainy days ~ elevation + distance to coast models
rsdys05.lm2 <- lm(sqrt(rain05_dys) ~ elev_m + d2coast, data = rainy05)
rsdys05.lm2a <- lm(sqrt(rain05_dys) ~ sqrt(elev_m) + d2coast, data = rainy05)
rsdys05.lm2b <- lm(sqrt(rain05_dys) ~ elev_m.sqr + d2coast, data = rainy05)
rsdys05.lm2c <- lm(sqrt(rain05_dys) ~ elev_m.log + d2coast, data = rainy05)
summary(rsdys05.lm2)# best adj. R-squared = 0.3195
summary(rsdys05.lm2a)
summary(rsdys05.lm2b)# adj. R-squared = 0.317
summary(rsdys05.lm2c)

# rsdys05.glm1 <- glm((rain05_dys) ~ elev_m + d2coast, family = "poisson", data = rainy05)
# summary(rsdys05.glm1)
# plot(rsdys05.glm1)
# 
# rsdys05.glm2 <- glm((rain05_dys) ~ elev_m.sqr + d2coast, family = "poisson", data = rainy05)
# summary(rsdys05.glm2)
# plot(rsdys05.glm2)

# Total rainfall ~ elevation + distance to Pacific models
rstot05.lm3 <- lm(totppt_mm ~ elev_m + d2pacific, data = rainy05)
rstot05.lm3a <- lm(totppt_mm ~ sqrt(elev_m) + d2pacific, data = rainy05)
rstot05.lm3b <- lm(totppt_mm ~ elev_m.sqr + d2pacific, data = rainy05)
rstot05.lm3c <- lm(totppt_mm ~ elev_m.log + d2pacific, data = rainy05)
summary(rstot05.lm3)
summary(rstot05.lm3a)
summary(rstot05.lm3b)
summary(rstot05.lm3c)
# These models all have negative adj. R-squared values

# Rainy days ~ elevation + distance to Pacific models
rsdys05.lm3 <- lm((rain05_dys) ~ elev_m + d2pacific, data = rainy05)
rsdys05.lm3a <- lm((rain05_dys) ~ sqrt(elev_m) + d2pacific, data = rainy05)
rsdys05.lm3b <- lm((rain05_dys) ~ elev_m.sqr + d2pacific, data = rainy05)
rsdys05.lm3c <- lm((rain05_dys) ~ elev_m.log + d2pacific, data = rainy05)
summary(rsdys05.lm3)
summary(rsdys05.lm3a)
summary(rsdys05.lm3b)
summary(rsdys05.lm3c)
# adj. R-squared values all ≈ 0.28

# d2coast & d2pacific both correlate with rainy days, but appear relatively orthogonal to each other for this season

# Rainy days ~ elevation + distance to Pacific + distance to coast
rsdys05.lm4 <- lm(rain05_dys ~ d2coast + elev_m + d2pacific, data = rainy05)
rsdys05.lm4a <- lm(rain05_dys ~ d2coast + sqrt(elev_m) + d2pacific, data = rainy05)
rsdys05.lm4b <- lm(rain05_dys ~ d2coast + elev_m.sqr + d2pacific, data = rainy05)
rsdys05.lm4c <- lm(rain05_dys ~ d2coast + elev_m.log + d2pacific, data = rainy05)
summary(rsdys05.lm4)# best adj. R-squared = 0.512
summary(rsdys05.lm4a)
summary(rsdys05.lm4b)
summary(rsdys05.lm4c)
# all adj. R-squared models ≈ 0.51


# rs05psm.lm <- lm(psm_totppt ~ elev_m + lat + lon, data = rainy05)
# rs05rg_elev.lm <- lm(totppt_mm ~ elev_m, data = rainy05)
# summary(rs05rg.lm)
# dredge(rs05rg.lm, extra = c("adjR^2", "R^2"))
# summary(rs05psm.lm)
# summary(rs05rg_elev.lm)
```

```{r RS 2006 OLS models, echo=F}
pairs(select(rainy06@data, totppt_mm, rain06_dys, elev_m, lat_utm, lon_utm, psm_totppt, d2coast, d2pacific),
      upper.panel = panel.cor, diag.panel = panel.hist,
      main = "2006 Rainy Season")

elev_m.sqr <- (rainy06@data$elev_m)^2
elev_m.log <- log1p(rainy06@data$elev_m)

# Total rainfall ~ elevation only models
rstot06.lm1 <- lm(totppt_mm ~ elev_m, data = rainy06)
rstot06.lm1a <- lm(totppt_mm ~ sqrt(elev_m), data = rainy06)
rstot06.lm1b <- lm(totppt_mm ~ elev_m.sqr, data = rainy06)
rstot06.lm1c <- lm(totppt_mm ~ elev_m.log, data = rainy06)
summary(rstot06.lm1)
summary(rstot06.lm1a)
summary(rstot06.lm1b)
summary(rstot06.lm1c)
# These models all have negative adj. R-squared

# Rainy days ~ elevation only models
rsdys06.lm1 <- lm((rain06_dys) ~ elev_m, data = rainy06)
rsdys06.lm1a <- lm((rain06_dys) ~ sqrt(elev_m), data = rainy06)
rsdys06.lm1b <- lm((rain06_dys) ~ elev_m.sqr, data = rainy06)
rsdys06.lm1c <- lm((rain06_dys) ~ elev_m.log, data = rainy06)
summary(rsdys06.lm1)
summary(rsdys06.lm1a)
summary(rsdys06.lm1b)
summary(rsdys06.lm1c)
# These models all have negative adj. R-squared

# Total rainfall ~ elevation + distance to coast models
rstot06.lm2 <- lm(totppt_mm ~ elev_m + d2coast, data = rainy06)
rstot06.lm2a <- lm(totppt_mm ~ sqrt(elev_m) + d2coast, data = rainy06)
rstot06.lm2b <- lm(totppt_mm ~ elev_m.sqr + d2coast, data = rainy06)
rstot06.lm2c <- lm(totppt_mm ~ elev_m.log + d2coast, data = rainy06)
summary(rstot06.lm2)
summary(rstot06.lm2a)
summary(rstot06.lm2b)# best adj. R-squared = 0.768
summary(rstot06.lm2c)

# Rainy days ~ elevation + distance to coast models
rsdys06.lm2 <- lm((rain06_dys) ~ elev_m + d2coast, data = rainy06)
rsdys06.lm2a <- lm((rain06_dys) ~ sqrt(elev_m) + d2coast, data = rainy06)
rsdys06.lm2b <- lm((rain06_dys) ~ elev_m.sqr + d2coast, data = rainy06)
rsdys06.lm2c <- lm((rain06_dys) ~ elev_m.log + d2coast, data = rainy06)
summary(rsdys06.lm2)
summary(rsdys06.lm2a)
summary(rsdys06.lm2b)
summary(rsdys06.lm2c)
# These all have negative R-squared values

# Rainy days ~ distance to coast model
rsdys06.lm3 <- lm((rain06_dys) ~ d2coast, data = rainy06)
summary(rsdys06.lm3)
# negative R-squared value

# Total rainfall ~ distance to coast model
rstot06.lm3b <- lm(totppt_mm ~ d2coast, data = rainy06)
summary(rstot06.lm3b)# adj. R-squared ≈ 0.534

# Rainy days ~ distance to pacific model
rsdys06.lm3a <- lm((rain06_dys) ~ d2pacific, data = rainy06)
summary(rsdys06.lm3a)
# negative R-squared value

# Total rainfall ~ distance to pacific model
rstot06.lm3c <- lm(totppt_mm ~ d2pacific, data = rainy06)
summary(rstot06.lm3c)


# Total rainfall ~ elevation + distance to pacific models
rstot06.lm4 <- lm(totppt_mm ~ elev_m + d2pacific, data = rainy06)
rstot06.lm4a <- lm(totppt_mm ~ sqrt(elev_m) + d2pacific, data = rainy06)
rstot06.lm4b <- lm(totppt_mm ~ elev_m.sqr + d2pacific, data = rainy06)
rstot06.lm4c <- lm(totppt_mm ~ elev_m.log + d2pacific, data = rainy06)
summary(rstot06.lm4)
summary(rstot06.lm4a)
summary(rstot06.lm4b)# best adj. R-squared = 0.762
summary(rstot06.lm4c)


rs06rg.lm <- lm(totppt_mm ~ elev_m + lat + lon, data = rainy06)
rs06psm.lm <- lm(psm_totppt ~ elev_m + lat + lon, data = rainy06)
rs06rg_elev.lm <- lm(totppt_mm ~ elev_m, data = rainy06)
summary(rs06rg.lm)
# dredge(rs06rg.lm, extra = c("adjR^2", "R^2")
summary(rs06psm.lm)
summary(rs06rg_elev.lm)
```

```{r RS 2007 OLS models}
pairs(select(rainy07@data, totppt_mm, rain07_dys, elev_m, lat_utm, lon_utm, psm_totppt, d2coast, d2pacific),
      upper.panel = panel.cor, diag.panel = panel.hist,
      main = "2007 Rainy Season")

elev_m.sqr <- (rainy07@data$elev_m)^2
elev_m.log <- log1p(rainy07@data$elev_m)

# Total rainfall ~ elevation only models
rstot07.lm1 <- lm(totppt_mm ~ elev_m, data = rainy07)
rstot07.lm1a <- lm(totppt_mm ~ sqrt(elev_m), data = rainy07)
rstot07.lm1b <- lm(totppt_mm ~ elev_m.sqr, data = rainy07)
rstot07.lm1c <- lm(totppt_mm ~ elev_m.log, data = rainy07)
summary(rstot07.lm1)# adj. R-squared = 0.143
summary(rstot07.lm1a)# adj. R-squared = 0.147
summary(rstot07.lm1b)
summary(rstot07.lm1c)

# Rainy days ~ elevation only models
rsdys07.lm1 <- lm((rain07_dys) ~ elev_m, data = rainy07)
rsdys07.lm1a <- lm((rain07_dys) ~ sqrt(elev_m), data = rainy07)
rsdys07.lm1b <- lm((rain07_dys) ~ elev_m.sqr, data = rainy07)
rsdys07.lm1c <- lm((rain07_dys) ~ elev_m.log, data = rainy07)
summary(rsdys07.lm1)
summary(rsdys07.lm1a)
summary(rsdys07.lm1b)# only positive R-squared = 0.038
summary(rsdys07.lm1c)

# Total rainfall ~ elevation + distance to coast
rstot07.lm2 <- lm(totppt_mm ~ elev_m + d2coast, data = rainy07)
rstot07.lm2a <- lm(totppt_mm ~ sqrt(elev_m) + d2coast, data = rainy07)
rstot07.lm2b <- lm(totppt_mm ~ elev_m.sqr + d2coast, data = rainy07)
rstot07.lm2c <- lm(totppt_mm ~ elev_m.log + d2coast, data = rainy07)
summary(rstot07.lm2)
summary(rstot07.lm2a)
summary(rstot07.lm2b)
summary(rstot07.lm2c)
# Very, very poor adj. R-squared values

# Rainy days ~ elevation + distance to coast
rsdys07.lm2 <- lm((rain07_dys) ~ elev_m + d2coast, data = rainy07)
rsdys07.lm2a <- lm((rain07_dys) ~ sqrt(elev_m) + d2coast, data = rainy07)
rsdys07.lm2b <- lm((rain07_dys) ~ elev_m.sqr + d2coast, data = rainy07)
rsdys07.lm2c <- lm((rain07_dys) ~ elev_m.log + d2coast, data = rainy07)
summary(rsdys07.lm2)
summary(rsdys07.lm2a)
summary(rsdys07.lm2b)
summary(rsdys07.lm2c)
# All R-squared values are negative

# Total rainfall ~ elevation + distance to Pacific
rstot07.lm3 <- lm(totppt_mm ~ elev_m + d2pacific, data = rainy07)
rstot07.lm3a <- lm(totppt_mm ~ sqrt(elev_m) + d2pacific, data = rainy07)
rstot07.lm3b <- lm(totppt_mm ~ elev_m.sqr + d2pacific, data = rainy07)
rstot07.lm3c <- lm(totppt_mm ~ elev_m.log + d2pacific, data = rainy07)
summary(rstot07.lm3)
summary(rstot07.lm3a)
summary(rstot07.lm3b)# adj. R-squared = 0.012
summary(rstot07.lm3c)
# Very, very poor adj. R-squared values

# Rainy days ~ elevation + distance to Pacific
rsdys07.lm3 <- lm((rain07_dys) ~ elev_m + d2pacific, data = rainy07)
rsdys07.lm3a <- lm((rain07_dys) ~ sqrt(elev_m) + d2pacific, data = rainy07)
rsdys07.lm3b <- lm((rain07_dys) ~ elev_m.sqr + d2pacific, data = rainy07)
rsdys07.lm3c <- lm((rain07_dys) ~ elev_m.log + d2pacific, data = rainy07)
summary(rsdys07.lm3)
summary(rsdys07.lm3a)
summary(rsdys07.lm3b)# best adj. R-squared = 0.677
summary(rsdys07.lm3c)
# all adj. R-squared values ~0.67

# Rainy days ~ distance to Pacific model
rsdys07.lm4 <- lm(rain07_dys ~ d2pacific, data = rainy07)
summary(rsdys07.lm4)# adj. R-squared = 0.723
rsdys07.lm4a <- lm(rain07_dys ~ d2coast, data = rainy07)
summary(rsdys07.lm4a)
rsdys07.lm4b <- lm(rain07_dys ~ d2pacific + d2coast, data = rainy07)
summary(rsdys07.lm4b)# adj. R-squared = 0.737

# rs07psm.lm <- lm(psm_totppt ~ elev_m + lat + lon, data = rainy07)
# rs07rg_elev.lm <- lm(totppt_mm ~ elev_m, data = rainy07)
# summary(rs07rg.lm)
# dredge(rs07rg.lm, extra = c("adjR^2", "R^2"))
# summary(rs07psm.lm)
# summary(rs07rg_elev.lm)
```

```{r RS 2008 OLS models}
pairs(select(rainy08@data, totppt_mm, rain08_dys, elev_m, lat_utm, lon_utm, psm_totppt, d2coast, d2pacific),
      upper.panel = panel.cor, diag.panel = panel.hist,
      main = "2008 Rainy Season")

elev_m.sqr <- (rainy08@data$elev_m)^2
elev_m.log <- log1p(rainy08@data$elev_m)

# Total rainfall ~ elevation only models
rstot08.lm1 <- lm(totppt_mm ~ elev_m, data = rainy08)
rstot08.lm1a <- lm(totppt_mm ~ sqrt(elev_m), data = rainy08)
rstot08.lm1b <- lm(totppt_mm ~ elev_m.sqr, data = rainy08)
rstot08.lm1c <- lm(totppt_mm ~ elev_m.log, data = rainy08)
summary(rstot08.lm1)
summary(rstot08.lm1a)
summary(rstot08.lm1b)
summary(rstot08.lm1c)
# All adj. R-squared values are negative

# Rainy days ~ elevation models
rsdys08.lm1 <- lm(rain08_dys ~ elev_m, data = rainy08)
rsdys08.lm1a <- lm(rain08_dys ~ sqrt(elev_m), data = rainy08)
rsdys08.lm1b <- lm(rain08_dys ~ elev_m.sqr, data = rainy08)
rsdys08.lm1c <- lm(rain08_dys ~ elev_m.log, data = rainy08)
summary(rsdys08.lm1)
summary(rsdys08.lm1a)
summary(rsdys08.lm1b)
summary(rsdys08.lm1c)
# All adj. R-squared values are negative

# Total rainfall ~ elevation only models + distance to coast
rstot08.lm2 <- lm(totppt_mm ~ elev_m + d2coast, data = rainy08)
rstot08.lm2a <- lm(totppt_mm ~ sqrt(elev_m) + d2coast, data = rainy08)
rstot08.lm2b <- lm(totppt_mm ~ elev_m.sqr + d2coast, data = rainy08)
rstot08.lm2c <- lm(totppt_mm ~ elev_m.log + d2coast, data = rainy08)
summary(rstot08.lm2)
summary(rstot08.lm2a)
summary(rstot08.lm2b)
summary(rstot08.lm2c)
# All adj. R-squared values are negative

# Rainy days ~ elevation models + distance to coast
rsdys08.lm2 <- lm(rain08_dys ~ elev_m + d2coast, data = rainy08)
rsdys08.lm2a <- lm(rain08_dys ~ sqrt(elev_m) + d2coast, data = rainy08)
rsdys08.lm2b <- lm(rain08_dys ~ elev_m.sqr + d2coast, data = rainy08)
rsdys08.lm2c <- lm(rain08_dys ~ elev_m.log + d2coast, data = rainy08)
summary(rsdys08.lm2)
summary(rsdys08.lm2a)
summary(rsdys08.lm2b)
summary(rsdys08.lm2c)
# All adj. R-squared values are negative

# Total rainfall ~ elevation only models + distance to Pacific
rstot08.lm3 <- lm(totppt_mm ~ elev_m + d2pacific, data = rainy08)
rstot08.lm3a <- lm(totppt_mm ~ sqrt(elev_m) + d2pacific, data = rainy08)
rstot08.lm3b <- lm(totppt_mm ~ elev_m.sqr + d2pacific, data = rainy08)
rstot08.lm3c <- lm(totppt_mm ~ elev_m.log + d2pacific, data = rainy08)
summary(rstot08.lm3)
summary(rstot08.lm3a)
summary(rstot08.lm3b)
summary(rstot08.lm3c)
# All adj. R-squared values are negative

# Rainy days ~ elevation models + distance to coast
rsdys08.lm3 <- lm(rain08_dys ~ elev_m + d2pacific, data = rainy08)
rsdys08.lm3a <- lm(rain08_dys ~ sqrt(elev_m) + d2pacific, data = rainy08)
rsdys08.lm3b <- lm(rain08_dys ~ elev_m.sqr + d2pacific, data = rainy08)
rsdys08.lm3c <- lm(rain08_dys ~ elev_m.log + d2pacific, data = rainy08)
summary(rsdys08.lm3)
summary(rsdys08.lm3a)
summary(rsdys08.lm3b)
summary(rsdys08.lm3c)
# All adj. R-squared values are negative

# Total rainfall ~ elevation + d2coast + d2pacific
rstot08.lm4 <- lm(totppt_mm ~ elev_m + d2coast + d2pacific, data = rainy08)
rstot08.lm4a <- lm(totppt_mm ~ d2coast + d2pacific, data = rainy08)
rstot08.lm4b <- lm(totppt_mm ~ d2pacific, data = rainy08)
rstot08.lm4c <- lm(totppt_mm ~ d2coast, data = rainy08)
summary(rstot08.lm4)
summary(rstot08.lm4a)
summary(rstot08.lm4b)# only positive adj. R-squared = 0.054
summary(rstot08.lm4c)

# rs08psm.lm <- lm(psm_totppt ~ elev_m + lat + lon, data = rainy08)
# rs08rg_elev.lm <- lm(totppt_mm ~ elev_m, data = rainy08)
# summary(rs08rg.lm)
# dredge(rs08rg.lm, extra = c("adjR^2", "R^2"))
# summary(rs08psm.lm)
# summary(rs08rg_elev.lm)
```

```{r RS 2009 OLS models}
pairs(select(rainy09@data, totppt_mm, rain09_dys, elev_m, lat_utm, lon_utm, psm_totppt, d2coast, d2pacific),
      upper.panel = panel.cor, diag.panel = panel.hist,
      main = "2009 Rainy Season")

elev_m.sqr <- (rainy09@data$elev_m)^2
elev_m.log <- log1p(rainy09@data$elev_m)

# Total rainfall ~ elevation only models
rstot09.lm1 <- lm(totppt_mm ~ elev_m, data = rainy09)
rstot09.lm1a <- lm(totppt_mm ~ sqrt(elev_m), data = rainy09)
rstot09.lm1b <- lm(totppt_mm ~ elev_m.sqr, data = rainy09)
rstot09.lm1c <- lm(totppt_mm ~ elev_m.log, data = rainy09)
summary(rstot09.lm1)
summary(rstot09.lm1a)
summary(rstot09.lm1b)
summary(rstot09.lm1c)
# All adj. R-squared values are negative

# Rainy days ~ elevation models
rsdys09.lm1 <- lm(rain09_dys ~ elev_m, data = rainy09)
rsdys09.lm1a <- lm(rain09_dys ~ sqrt(elev_m), data = rainy09)
rsdys09.lm1b <- lm(rain09_dys ~ elev_m.sqr, data = rainy09)
rsdys09.lm1c <- lm(rain09_dys ~ elev_m.log, data = rainy09)
summary(rsdys09.lm1)
summary(rsdys09.lm1a)
summary(rsdys09.lm1b)
summary(rsdys09.lm1c)
# All adj. R-squared values are negative

# Total rainfall ~ elevation + d2coast
rstot09.lm2 <- lm(totppt_mm ~ elev_m + d2coast, data = rainy09)
rstot09.lm2a <- lm(totppt_mm ~ sqrt(elev_m) + d2coast, data = rainy09)
rstot09.lm2b <- lm(totppt_mm ~ elev_m.sqr + d2coast, data = rainy09)
rstot09.lm2c <- lm(totppt_mm ~ elev_m.log + d2coast, data = rainy09)
summary(rstot09.lm2)
summary(rstot09.lm2a)
summary(rstot09.lm2b)
summary(rstot09.lm2c)
# All adj. R-squared values are negative

# Rainy days ~ elevation models + d2coast
rsdys09.lm2 <- lm(rain09_dys ~ elev_m + d2coast, data = rainy09)
rsdys09.lm2a <- lm(rain09_dys ~ sqrt(elev_m) + d2coast, data = rainy09)
rsdys09.lm2b <- lm(rain09_dys ~ elev_m.sqr + d2coast, data = rainy09)
rsdys09.lm2c <- lm(rain09_dys ~ elev_m.log + d2coast, data = rainy09)
summary(rsdys09.lm2)
summary(rsdys09.lm2a)
summary(rsdys09.lm2b)
summary(rsdys09.lm2c)# best adj. R-squared = 0.039

# Total rainfall ~ elevation + d2pacific
rstot09.lm3 <- lm(totppt_mm ~ elev_m + d2pacific, data = rainy09)
rstot09.lm3a <- lm(totppt_mm ~ sqrt(elev_m) + d2pacific, data = rainy09)
rstot09.lm3b <- lm(totppt_mm ~ elev_m.sqr + d2pacific, data = rainy09)
rstot09.lm3c <- lm(totppt_mm ~ elev_m.log + d2pacific, data = rainy09)
summary(rstot09.lm3)
summary(rstot09.lm3a)
summary(rstot09.lm3b)
summary(rstot09.lm3c)
# All adj. R-squared values are negative

# Rainy days ~ elevation models + d2pacific
rsdys09.lm3 <- lm(rain09_dys ~ elev_m + d2pacific, data = rainy09)
rsdys09.lm3a <- lm(rain09_dys ~ sqrt(elev_m) + d2pacific, data = rainy09)
rsdys09.lm3b <- lm(rain09_dys ~ elev_m.sqr + d2pacific, data = rainy09)
rsdys09.lm3c <- lm(rain09_dys ~ elev_m.log + d2pacific, data = rainy09)
summary(rsdys09.lm3)
summary(rsdys09.lm3a)
summary(rsdys09.lm3b)
summary(rsdys09.lm3c)
# All adj. R-squared values are negative

# Total rainfall ~ d2coast + d2pacific + elevation
rstot09.lm4 <- lm(totppt_mm ~ elev_m + d2pacific + d2coast, data = rainy09)
rstot09.lm4a <- lm(totppt_mm ~ sqrt(elev_m) + d2pacific + d2coast, data = rainy09)
rstot09.lm4b <- lm(totppt_mm ~ elev_m.sqr + d2pacific + d2coast, data = rainy09)
rstot09.lm4c <- lm(totppt_mm ~ elev_m.log + d2pacific + d2coast, data = rainy09)
summary(rstot09.lm4)
summary(rstot09.lm4a)
summary(rstot09.lm4b)
summary(rstot09.lm4c)
# All adj. R-squared values are negative

# Rainy days ~ elevation + d2pacific + d2coast
rsdys09.lm4 <- lm(rain09_dys ~ elev_m + d2pacific + d2coast, data = rainy09)
rsdys09.lm4a <- lm(rain09_dys ~ sqrt(elev_m) + d2pacific + d2coast, data = rainy09)
rsdys09.lm4b <- lm(rain09_dys ~ elev_m.sqr + d2pacific + d2coast, data = rainy09)
rsdys09.lm4c <- lm(rain09_dys ~ elev_m.log + d2pacific + d2coast, data = rainy09)
summary(rsdys09.lm4)
summary(rsdys09.lm4a)
summary(rsdys09.lm4b)
summary(rsdys09.lm4c)

# Total rainfall ~ d2coast
rstot09.lm5 <- lm(totppt_mm ~ d2coast, data = rainy09)
summary(rstot09.lm5)# adj. R-squared = 0.031

# Total rainfall ~ d2pacific
rstot09.lm5a <- lm(totppt_mm ~ d2pacific, data = rainy09)
summary(rstot09.lm5a)# adj. R-squared is negative

# Total rainfall ~ d2coast + d2pacific
rstot09.lm5b <- lm(totppt_mm ~ d2coast + d2pacific, data = rainy09)
summary(rstot09.lm5b)# adj. R-squared is negative

# Rainy days ~ d2coast
rsdys09.lm5 <- lm(rain09_dys ~ d2coast, data = rainy09)
summary(rsdys09.lm4)# adj. R-squared = 0.108

# Rainy days ~ d2pacific
rsdys09.lm5a <- lm(rain09_dys ~ d2pacific, data = rainy09)
summary(rsdys09.lm5a)# adj. R-squared is negative

# Rainy days ~ d2coast + d2pacific
rsdys09.lm5b <- lm(rain09_dys ~ d2coast + d2pacific, data = rainy09)
summary(rsdys09.lm5b)# adj. R-squared = 0.094

# rs09rg.lm <- lm(totppt_mm ~ elev_m + lat + lon, data = rainy09)
# rs09psm.lm <- lm(psm_totppt ~ elev_m + lat + lon, data = rainy09)
# rs09rg_elev.lm <- lm(totppt_mm ~ elev_m, data = rainy09)
# summary(rs09rg.lm)
# dredge(rs09rg.lm, extra = c("adjR^2", "R^2"))
# summary(rs09psm.lm)
# summary(rs09rg_elev.lm)
```

```{r RS 2010 OLS models}
pairs(select(rainy10@data, totppt_mm, rain10_dys, elev_m, lat_utm, lon_utm, psm_totppt, d2coast, d2pacific),
      upper.panel = panel.cor, diag.panel = panel.hist,
      main = "2010 Rainy Season")

elev_m.sqr <- (rainy10@data$elev_m)^2
elev_m.log <- log1p(rainy10@data$elev_m)

# Total rainfall ~ elevation only models
rstot10.lm1 <- lm(totppt_mm ~ elev_m, data = rainy10)
rstot10.lm1a <- lm(totppt_mm ~ sqrt(elev_m), data = rainy10)
rstot10.lm1b <- lm(totppt_mm ~ elev_m.sqr, data = rainy10)
rstot10.lm1c <- lm(totppt_mm ~ elev_m.log, data = rainy10)
summary(rstot10.lm1)
summary(rstot10.lm1a)
summary(rstot10.lm1b)
summary(rstot10.lm1c)
# All adj. R-squared values are negative

# Rainy days ~ elevation models
rsdys10.lm1 <- lm(rain10_dys ~ elev_m, data = rainy10)
rsdys10.lm1a <- lm(rain10_dys ~ sqrt(elev_m), data = rainy10)
rsdys10.lm1b <- lm(rain10_dys ~ elev_m.sqr, data = rainy10)
rsdys10.lm1c <- lm(rain10_dys ~ elev_m.log, data = rainy10)
summary(rsdys10.lm1)
summary(rsdys10.lm1a)
summary(rsdys10.lm1b)
summary(rsdys10.lm1c)
# All adj. R-squared values are negative

# Total rainfall ~ elevation + d2coast
rstot10.lm2 <- lm(totppt_mm ~ elev_m + d2coast, data = rainy10)
# rstot10.lm2a <- lm(totppt_mm ~ sqrt(elev_m) + d2coast, data = rainy10)
rstot10.lm2b <- lm(totppt_mm ~ elev_m + elev_m.sqr + d2coast, data = rainy10)
rstot10.lm2c <- lm(totppt_mm ~ elev_m.log + d2coast, data = rainy10)
summary(rstot10.lm2)# best adj. R-squared = 0.707
# summary(rstot10.lm2a)
summary(rstot10.lm2b)# adj. R-squared = 0.699
summary(rstot10.lm2c)# better looking residual plots
# Residual plots look bad, d2coast & elevation are correlated r = -0.64

# Rainy days ~ elevation models + d2coast
rsdys10.lm2 <- lm(rain10_dys ~ elev_m + d2coast, data = rainy10)
# rsdys10.lm2a <- lm(rain10_dys ~ sqrt(elev_m) + d2coast, data = rainy10)
rsdys10.lm2b <- lm(rain10_dys ~ elev_m.sqr + d2coast, data = rainy10)
rsdys10.lm2c <- lm(rain10_dys ~ elev_m.log + d2coast, data = rainy10)
summary(rsdys10.lm2)
# summary(rsdys10.lm2a)
summary(rsdys10.lm2b)
summary(rsdys10.lm2c)
# All adj. R-squared values are negative

# Total rainfall ~ elevation + d2pacific
rstot10.lm3 <- lm(totppt_mm ~ elev_m + d2pacific, data = rainy10)
# rstot10.lm3a <- lm(totppt_mm ~ sqrt(elev_m) + d2pacific, data = rainy10)
rstot10.lm3b <- lm(totppt_mm ~ elev_m.sqr + d2pacific, data = rainy10)
rstot10.lm3c <- lm(totppt_mm ~ elev_m.log + d2pacific, data = rainy10)
summary(rstot10.lm3)
# summary(rstot10.lm3a)
summary(rstot10.lm3b)
summary(rstot10.lm3c)
# All adj. R-squared values are negative

# Rainy days ~ elevation models + d2pacific
rsdys10.lm3 <- lm(rain10_dys ~ elev_m + d2pacific, data = rainy10)
# rsdys10.lm3a <- lm(rain10_dys ~ sqrt(elev_m) + d2pacific, data = rainy10)
rsdys10.lm3b <- lm(rain10_dys ~ elev_m.sqr + d2pacific, data = rainy10)
rsdys10.lm3c <- lm(rain10_dys ~ elev_m.log + d2pacific, data = rainy10)
summary(rsdys10.lm3)# adj. R-squared = 0.162
# summary(rsdys10.lm3a)
summary(rsdys10.lm3b)# adj. R-squared = 0.167
summary(rsdys10.lm3c)# adj. R-squared = 0.147
# plot(rsdys10.lm3c)

# Total rainfall ~ d2coast + d2pacific + elevation
rstot10.lm4 <- lm(totppt_mm ~ d2coast + d2pacific + elev_m, data = rainy10)
rstot10.lm4a <- lm(totppt_mm ~ d2coast + d2pacific + elev_m.log, data = rainy10)
rstot10.lm4b <- lm(totppt_mm ~ d2coast + d2pacific + elev_m + elev_m.sqr, data = rainy10)
summary(rstot10.lm4)# adj. R-squared = 0.697
summary(rstot10.lm4a)# adj. R-squared = 0.684
summary(rstot10.lm4b)# adj. R-squared = 0.655

# Rainy days ~ d2coast + d2pacific + elevation
rsdys10.lm4 <- lm(rain10_dys ~ d2coast + d2pacific + elev_m, data = rainy10)
rsdys10.lm4a <- lm(rain10_dys ~ d2coast + d2pacific + elev_m.log, data = rainy10)
rsdys10.lm4b <- lm(rain10_dys ~ d2coast + d2pacific + elev_m + elev_m.sqr, data = rainy10)
summary(rsdys10.lm4)# adj. R-squared = 0.044
summary(rsdys10.lm4a)
summary(rsdys10.lm4b)

# Total rainfall ~ distance to coast
rstot10.lm5 <- lm(totppt_mm ~ d2coast, data = rainy10)
summary(rstot10.lm4)# adj. R-squared = 0.17

# Total rainfall ~ d2coast + d2pacific
rstot10.lm5a <- lm(totppt_mm ~ d2coast + d2pacific, data = rainy10)
summary(rstot10.lm4a)# adj. R-squared = 0.087

# Rainy days ~ d2coast
rsdys10.lm5 <- lm(rain10_dys ~ d2coast, data = rainy10)
summary(rsdys10.lm5)# adj. R-squared is negative

# Rainy days ~ d2pacific
rsdys10.lm5a <- lm(rain10_dys ~ d2pacific, data = rainy10)
summary(rsdys10.lm5a)# adj. R-squared = 0.195

# Rainy days ~ d2coast + d2pacific
rsdys10.lm5b <- lm(rain10_dys ~ d2coast + d2pacific, data = rainy10)
summary(rsdys10.lm5b)# adj. R-squared = 0.131


# rs10rg.lm <- lm(totppt_mm ~ elev_m + lat + lon, data = rainy10)
# rs10psm.lm <- lm(psm_totppt ~ elev_m + lat + lon, data = rainy10)
# rs10rg_elev.lm <- lm(totppt_mm ~ elev_m, data = rainy10)
# summary(rs10rg.lm)
# # dredge(rs10rg.lm, extra = c("adjR^2", "R^2"))
# summary(rs10psm.lm)
# summary(rs10rg_elev.lm)
```

```{r RS 2011 OLS models}
pairs(select(rainy11@data, totppt_mm, rain11_dys, elev_m, lat_utm, lon_utm, d2coast, d2pacific),
      upper.panel = panel.cor, diag.panel = panel.hist,
      main = "2011 Rainy Season")

elev_m.sqr <- (rainy11@data$elev_m)^2
elev_m.log <- log1p(rainy11@data$elev_m)

# Total rainfall ~ elevation only models
rstot11.lm1 <- lm(totppt_mm ~ elev_m, data = rainy11)
rstot11.lm1a <- lm(totppt_mm ~ sqrt(elev_m), data = rainy11)
rstot11.lm1b <- lm(totppt_mm ~ elev_m.sqr, data = rainy11)
rstot11.lm1c <- lm(totppt_mm ~ elev_m.log, data = rainy11)
summary(rstot11.lm1)
summary(rstot11.lm1a)
summary(rstot11.lm1b)# adj. R-squared = 0.011
summary(rstot11.lm1c)
# All other adj. R-squared values are negative

# Rainy days ~ elevation models
rsdys11.lm1 <- lm(rain11_dys ~ elev_m, data = rainy11)
# rsdys11.lm1a <- lm(rain11_dys ~ sqrt(elev_m), data = rainy11)
rsdys11.lm1b <- lm(rain11_dys ~ elev_m + elev_m.sqr, data = rainy11)
rsdys11.lm1c <- lm(rain11_dys ~ elev_m.log, data = rainy11)
summary(rsdys11.lm1)# adj. R-squared = 0.18
# summary(rsdys11.lm1a)
summary(rsdys11.lm1b)# adj. R-squared = 0.232
summary(rsdys11.lm1c)
par(mfrow=c(2,2))
# plot(rsdys11.lm1b)

# Total rainfall ~ elevation + d2coast
rstot11.lm2 <- lm(totppt_mm ~ elev_m + d2coast, data = rainy11)
# rstot11.lm2a <- lm(totppt_mm ~ sqrt(elev_m) + d2coast, data = rainy11)
rstot11.lm2b <- lm(totppt_mm ~ elev_m + elev_m.sqr + d2coast, data = rainy11)
rstot11.lm2c <- lm(totppt_mm ~ elev_m.log + d2coast, data = rainy11)
summary(rstot11.lm2)
# summary(rstot11.lm2a)
summary(rstot11.lm2b)
summary(rstot11.lm2c)
# All adj. R-squared values are negative

# Rainy days ~ elevation models + d2coast
rsdys11.lm2 <- lm(rain11_dys ~ elev_m + d2coast, data = rainy11)
# rsdys11.lm2a <- lm(rain11_dys ~ sqrt(elev_m) + d2coast, data = rainy11)
rsdys11.lm2b <- lm(rain11_dys ~ elev_m + elev_m.sqr + d2coast, data = rainy11)
rsdys11.lm2c <- lm(rain11_dys ~ elev_m.log + d2coast, data = rainy11)
summary(rsdys11.lm2)# adj. R-squared = 0.101
# summary(rsdys11.lm2a)
summary(rsdys11.lm2b)# adj. R-squared = 0.152
summary(rsdys11.lm2c)

# Total rainfall ~ elevation + d2pacific
rstot11.lm3 <- lm(totppt_mm ~ elev_m + d2pacific, data = rainy11)
# rstot11.lm3a <- lm(totppt_mm ~ sqrt(elev_m) + d2pacific, data = rainy11)
rstot11.lm3b <- lm(totppt_mm ~ elev_m.sqr + d2pacific, data = rainy11)
rstot11.lm3c <- lm(totppt_mm ~ elev_m.log + d2pacific, data = rainy11)
summary(rstot11.lm3)
# summary(rstot11.lm3a)
summary(rstot11.lm3b)
summary(rstot11.lm3c)
# All adj. R-squared values are negative

# Rainy days ~ elevation models + d2pacific
rsdys11.lm3 <- lm(rain11_dys ~ elev_m + d2pacific, data = rainy11)
# rsdys11.lm3a <- lm(rain11_dys ~ sqrt(elev_m) + d2pacific, data = rainy11)
rsdys11.lm3b <- lm(rain11_dys ~ elev_m + elev_m.sqr + d2pacific, data = rainy11)
rsdys11.lm3c <- lm(rain11_dys ~ elev_m.log + d2pacific, data = rainy11)
summary(rsdys11.lm3)# adj. R-squared = 0.089
# summary(rsdys11.lm3a)
summary(rsdys11.lm3b)# adj. R-squared = 0.187
summary(rsdys11.lm3c)
plot(rsdys11.lm3)

# Total rainfall ~ d2coast + d2pacific + elevation
rstot11.lm4 <- lm(totppt_mm ~ d2coast + d2pacific + elev_m, data = rainy11)
rstot11.lm4a <- lm(totppt_mm ~ d2coast + d2pacific + elev_m.log, data = rainy11)
rstot11.lm4b <- lm(totppt_mm ~ d2coast + d2pacific + elev_m + elev_m.sqr, data = rainy11)
summary(rstot11.lm4)
summary(rstot11.lm4a)
summary(rstot11.lm4b)
# All adj. R-squared values are negative

# Rainy days ~ d2coast + d2pacific + elevation
rsdys11.lm4 <- lm(rain11_dys ~ d2coast + d2pacific + elev_m, data = rainy11)
rsdys11.lm4a <- lm(rain11_dys ~ d2coast + d2pacific + elev_m.log, data = rainy11)
rsdys11.lm4b <- lm(rain11_dys ~ d2coast + d2pacific + elev_m + elev_m.sqr, data = rainy11)
summary(rsdys11.lm4)
summary(rsdys11.lm4a)
summary(rsdys11.lm4b)# adj. R-squared = 0.079

# Total rainfall ~ distance to coast
rstot11.lm5 <- lm(totppt_mm ~ d2coast, data = rainy11)
summary(rstot11.lm4)# adj. R-squared is negative

# Total rainfall ~ d2coast + d2pacific
rstot11.lm5a <- lm(totppt_mm ~ d2coast + d2pacific, data = rainy11)
summary(rstot11.lm4a)# adj. R-squared is negative

# Rainy days ~ d2coast
rsdys11.lm5 <- lm(rain11_dys ~ d2coast, data = rainy11)
summary(rsdys11.lm5)# adj. R-squared is negative

# Rainy days ~ d2pacific
rsdys11.lm5a <- lm(rain11_dys ~ d2pacific, data = rainy11)
summary(rsdys11.lm5a)# adj. R-squared is negative

# Rainy days ~ d2coast + d2pacific
rsdys11.lm5b <- lm(rain11_dys ~ d2coast + d2pacific, data = rainy11)
summary(rsdys11.lm5b)# adj. R-squared is negative


# rs11rg.lm <- lm(totppt_mm ~ elev_m + lat + lon, data = rainy11)
# rs11rg_elev.lm <- lm(totppt_mm ~ elev_m, data = rainy11)
# summary(rs11rg.lm)
# summary(rs11rg_elev.lm)
```

```{r RS 2012 OLS models}
pairs(select(rainy12@data, totppt_mm, rain12_dys, elev_m, lat_utm, lon_utm, d2coast, d2pacific),
      upper.panel = panel.cor, diag.panel = panel.hist,
      main = "2012 Rainy Season")

elev_m.sqr <- (rainy12@data$elev_m)^2
elev_m.log <- log1p(rainy12@data$elev_m)

# Total rainfall ~ elevation only models
rstot12.lm1 <- lm(totppt_mm ~ elev_m, data = rainy12)
rstot12.lm1a <- lm(totppt_mm ~ sqrt(elev_m), data = rainy12)
rstot12.lm1b <- lm(totppt_mm ~ elev_m.sqr, data = rainy12)
rstot12.lm1c <- lm(totppt_mm ~ elev_m.log, data = rainy12)
summary(rstot12.lm1)
summary(rstot12.lm1a)
summary(rstot12.lm1b)
summary(rstot12.lm1c)
# All adj. R-squared values are negative

# Rainy days ~ elevation models
rsdys12.lm1 <- lm(rain12_dys ~ elev_m, data = rainy12)
rsdys12.lm1a <- lm(rain12_dys ~ sqrt(elev_m), data = rainy12)
rsdys12.lm1b <- lm(rain12_dys ~ elev_m.sqr, data = rainy12)
rsdys12.lm1c <- lm(rain12_dys ~ elev_m.log, data = rainy12)
summary(rsdys12.lm1)
summary(rsdys12.lm1a)
summary(rsdys12.lm1b)
summary(rsdys12.lm1c)
# All adj. R-squared values are negative

# Total rainfall ~ elevation + d2coast
rstot12.lm2 <- lm(totppt_mm ~ elev_m + d2coast, data = rainy12)
# rstot12.lm2a <- lm(totppt_mm ~ sqrt(elev_m) + d2coast, data = rainy12)
rstot12.lm2b <- lm(totppt_mm ~ elev_m + elev_m.sqr + d2coast, data = rainy12)
rstot12.lm2c <- lm(totppt_mm ~ elev_m.log + d2coast, data = rainy12)
summary(rstot12.lm2)
# summary(rstot12.lm2a)
summary(rstot12.lm2b)
summary(rstot12.lm2c)
# All adj. R-squared values are negative

# Rainy days ~ elevation models + d2coast
rsdys12.lm2 <- lm(rain12_dys ~ elev_m + d2coast, data = rainy12)
# rsdys12.lm2a <- lm(rain12_dys ~ sqrt(elev_m) + d2coast, data = rainy12)
rsdys12.lm2b <- lm(rain12_dys ~ elev_m.sqr + d2coast, data = rainy12)
rsdys12.lm2c <- lm(rain12_dys ~ elev_m.log + d2coast, data = rainy12)
summary(rsdys12.lm2)
# summary(rsdys12.lm2a)
summary(rsdys12.lm2b)
summary(rsdys12.lm2c)
# All adj. R-squared values are negative

# Total rainfall ~ elevation + d2pacific
rstot12.lm3 <- lm(totppt_mm ~ elev_m + d2pacific, data = rainy12)
# rstot12.lm3a <- lm(totppt_mm ~ sqrt(elev_m) + d2pacific, data = rainy12)
rstot12.lm3b <- lm(totppt_mm ~ elev_m.sqr + d2pacific, data = rainy12)
rstot12.lm3c <- lm(totppt_mm ~ elev_m.log + d2pacific, data = rainy12)
summary(rstot12.lm3)# adj. R-squared = 0.171
# summary(rstot12.lm3a)
summary(rstot12.lm3b)# adj. R-squared = 0.167
summary(rstot12.lm3c)# adj. R-squared = 0.184

# Rainy days ~ elevation models + d2pacific
rsdys12.lm3 <- lm(rain12_dys ~ elev_m + d2pacific, data = rainy12)
# rsdys12.lm3a <- lm(rain12_dys ~ sqrt(elev_m) + d2pacific, data = rainy12)
rsdys12.lm3b <- lm(rain12_dys ~ elev_m.sqr + d2pacific, data = rainy12)
rsdys12.lm3c <- lm(rain12_dys ~ elev_m.log + d2pacific, data = rainy12)
summary(rsdys12.lm3)
# summary(rsdys12.lm3a)
summary(rsdys12.lm3b)
summary(rsdys12.lm3c)# adj. R-squared = 0.039
# plot(rsdys12.lm3c)

# Total rainfall ~ d2coast + d2pacific + elevation
rstot12.lm4 <- lm(totppt_mm ~ d2coast + d2pacific + elev_m, data = rainy12)
rstot12.lm4a <- lm(totppt_mm ~ d2coast + d2pacific + elev_m.log, data = rainy12)
rstot12.lm4b <- lm(totppt_mm ~ d2coast + d2pacific + elev_m + elev_m.sqr, data = rainy12)
summary(rstot12.lm4)
summary(rstot12.lm4a)
summary(rstot12.lm4b)# adj. R-squared = 0.215

# Rainy days ~ d2coast + d2pacific + elevation
rsdys12.lm4 <- lm(rain12_dys ~ d2coast + d2pacific + elev_m, data = rainy12)
rsdys12.lm4a <- lm(rain12_dys ~ d2coast + d2pacific + elev_m.log, data = rainy12)
rsdys12.lm4b <- lm(rain12_dys ~ d2coast + d2pacific + elev_m + elev_m.sqr, data = rainy12)
summary(rsdys12.lm4)
summary(rsdys12.lm4a)
summary(rsdys12.lm4b)
# All adj. R-squared values are negative

# Total rainfall ~ distance to coast
rstot12.lm5 <- lm(totppt_mm ~ d2coast, data = rainy12)
summary(rstot12.lm5)# adj. R-squared is negative

# Total rainfall ~ distance to Pacific
rstot12.lm5a <- lm(totppt_mm ~ d2pacific, data = rainy12)
summary(rstot12.lm5a)# adj. R-squared = 0.375

# Total rainfall ~ d2coast + d2pacific
rstot12.lm5b <- lm(totppt_mm ~ d2coast + d2pacific, data = rainy12)
summary(rstot12.lm5b)# adj. R-squared = 0.167

# Rainy days ~ d2coast
rsdys12.lm5 <- lm(rain12_dys ~ d2coast, data = rainy12)
summary(rsdys12.lm5)# adj. R-squared is negative

# Rainy days ~ d2pacific
rsdys12.lm5a <- lm(rain12_dys ~ d2pacific, data = rainy12)
summary(rsdys12.lm5a)# adj. R-squared is negative

# Rainy days ~ d2coast + d2pacific
rsdys12.lm5b <- lm(rain12_dys ~ d2coast + d2pacific, data = rainy12)
summary(rsdys12.lm5b)# adj. R-squared is negative


# rs12rg.lm <- lm(totppt_mm ~ elev_m + lat + lon, data = rainy12)
# rs12rg_elev.lm <- lm(totppt_mm ~ elev_m, data = rainy12)
# summary(rs12rg.lm)
# summary(rs12rg_elev.lm)
```

```{r RS 2014 OLS models}
pairs(select(rainy14@data, totppt_mm, rain14_dys, elev_m, lat_utm, lon_utm, d2coast, d2pacific),
      upper.panel = panel.cor, diag.panel = panel.hist,
      main = "2014 Rainy Season")

elev_m.sqr <- (rainy14@data$elev_m)^2
elev_m.log <- log1p(rainy14@data$elev_m)

# Total rainfall ~ elevation only models
rstot14.lm1 <- lm(totppt_mm ~ elev_m, data = rainy14)
rstot14.lm1a <- lm(totppt_mm ~ sqrt(elev_m), data = rainy14)
# rstot14.lm1b <- lm(totppt_mm ~ elev_m + elev_m.sqr, data = rainy14)
rstot14.lm1c <- lm(totppt_mm ~ elev_m.log, data = rainy14)
summary(rstot14.lm1)# adj. R-squared = 0.319
summary(rstot14.lm1a)# adj. R-squared = 0.359
# summary(rstot14.lm1b)
summary(rstot14.lm1c)# adj. R-squared = 0.357

# Rainy days ~ elevation models
rsdys14.lm1 <- lm(rain14_dys ~ elev_m, data = rainy14)
rsdys14.lm1a <- lm(rain14_dys ~ sqrt(elev_m), data = rainy14)
rsdys14.lm1b <- lm(rain14_dys ~ elev_m.sqr, data = rainy14)
rsdys14.lm1c <- lm(rain14_dys ~ elev_m.log, data = rainy14)
summary(rsdys14.lm1)
summary(rsdys14.lm1a)
summary(rsdys14.lm1b)
summary(rsdys14.lm1c)
# All adj. R-squared values are negative

# Total rainfall ~ elevation + d2coast
rstot14.lm2 <- lm(totppt_mm ~ elev_m + d2coast, data = rainy14)
rstot14.lm2a <- lm(totppt_mm ~ sqrt(elev_m) + d2coast, data = rainy14)
# rstot14.lm2b <- lm(totppt_mm ~ elev_m + elev_m.sqr + d2coast, data = rainy14)
rstot14.lm2c <- lm(totppt_mm ~ elev_m.log + d2coast, data = rainy14)
summary(rstot14.lm2)# adj. R-squared = 0.475
summary(rstot14.lm2a)# adj. R-squared = 0.613
# summary(rstot14.lm2b)
summary(rstot14.lm2c)# adj. R-squared = 0.611
# Residual plots look bad, d2coast & elevation are correlated r = -0.64

# Rainy days ~ elevation models + d2coast
rsdys14.lm2 <- lm(rain14_dys ~ elev_m + d2coast, data = rainy14)
rsdys14.lm2a <- lm(rain14_dys ~ sqrt(elev_m) + d2coast, data = rainy14)
# rsdys14.lm2b <- lm(rain14_dys ~ elev_m.sqr + d2coast, data = rainy14)
rsdys14.lm2c <- lm(rain14_dys ~ elev_m.log + d2coast, data = rainy14)
summary(rsdys14.lm2)
summary(rsdys14.lm2a)
# summary(rsdys14.lm2b)
summary(rsdys14.lm2c)
# All adj. R-squared values are negative

# Total rainfall ~ elevation + d2pacific
rstot14.lm3 <- lm(totppt_mm ~ elev_m + d2pacific, data = rainy14)
rstot14.lm3a <- lm(totppt_mm ~ sqrt(elev_m) + d2pacific, data = rainy14)
# rstot14.lm3b <- lm(totppt_mm ~ elev_m.sqr + d2pacific, data = rainy14)
rstot14.lm3c <- lm(totppt_mm ~ elev_m.log + d2pacific, data = rainy14)
summary(rstot14.lm3)# adj. R-squared = 0.12
summary(rstot14.lm3a)# adj. R-squared = 0.243
# summary(rstot14.lm3b)
summary(rstot14.lm3c)# adj. R-squared = 0.361

# Rainy days ~ elevation models + d2pacific
rsdys14.lm3 <- lm(rain14_dys ~ elev_m + d2pacific, data = rainy14)
rsdys14.lm3a <- lm(rain14_dys ~ sqrt(elev_m) + d2pacific, data = rainy14)
# rsdys14.lm3b <- lm(rain14_dys ~ elev_m.sqr + d2pacific, data = rainy14)
rsdys14.lm3c <- lm(rain14_dys ~ elev_m.log + d2pacific, data = rainy14)
summary(rsdys14.lm3)# adj. R-squared = 0.488
summary(rsdys14.lm3a)# adj. R-squared = 0.525
# summary(rsdys14.lm3b)
summary(rsdys14.lm3c)# adj. R-squared = 0.581
# plot(rsdys14.lm3c)

# Total rainfall ~ d2coast + d2pacific + elevation
rstot14.lm4 <- lm(totppt_mm ~ d2coast + d2pacific + elev_m, data = rainy14)
rstot14.lm4a <- lm(totppt_mm ~ d2coast + d2pacific + elev_m.log, data = rainy14)
# rstot14.lm4b <- lm(totppt_mm ~ d2coast + d2pacific + elev_m + elev_m.sqr, data = rainy14)
summary(rstot14.lm4)# adj. R-squared is negative
summary(rstot14.lm4a)# adj. R-squared = 0.585
# summary(rstot14.lm4b)

# Rainy days ~ d2coast + d2pacific + elevation
rsdys14.lm4 <- lm(rain14_dys ~ d2coast + d2pacific + elev_m, data = rainy14)
rsdys14.lm4a <- lm(rain14_dys ~ d2coast + d2pacific + elev_m.log, data = rainy14)
# rsdys14.lm4b <- lm(rain14_dys ~ d2coast + d2pacific + elev_m + elev_m.sqr, data = rainy14)
summary(rsdys14.lm4)# adj. R-squared = 0.142
summary(rsdys14.lm4a)# adj. R-squared = 0.245
# summary(rsdys14.lm4b)

# Total rainfall ~ distance to coast
rstot14.lm5 <- lm(totppt_mm ~ d2coast, data = rainy14)
summary(rstot14.lm4)# adj. R-squared is negative

# Total rainfall ~ d2pacific
rstot14.lm5a <- lm(totppt_mm ~ d2pacific, data = rainy14)
summary(rstot14.lm5a)# adj. R-squared = 0.125

# Total rainfall ~ d2coast + d2pacific
rstot14.lm5b <- lm(totppt_mm ~ d2coast + d2pacific, data = rainy14)
summary(rstot14.lm5b)# adj. R-squared is negative

# Rainy days ~ d2coast
rsdys14.lm5 <- lm(rain14_dys ~ d2coast, data = rainy14)
summary(rsdys14.lm5)# adj. R-squared is negative

# Rainy days ~ d2pacific
rsdys14.lm5a <- lm(rain14_dys ~ d2pacific, data = rainy14)
summary(rsdys14.lm5a)# adj. R-squared = 0.428

# Rainy days ~ d2coast + d2pacific
rsdys14.lm5b <- lm(rain14_dys ~ d2coast + d2pacific, data = rainy14)
summary(rsdys14.lm5b)# adj. R-squared = 0.568

# rs14rg.lm <- lm(totppt_mm ~ elev_m + lat + lon, data = rainy14)
# rs14rg_elev.lm <- lm(totppt_mm ~ elev_m, data = rainy14)
# summary(rs14rg.lm)
# summary(rs14rg_elev.lm)
```


```{r precipitation variogram}
library(gstat); library(geoR)
summary(stations_0308)

library(raster)
elev <- raster("dem/sod15m.tif")
elev
stations_0308$elev_m <- extract(elev * .3048, stations_0308)
stations_0911$elev_m <- extract(elev * .3048, stations_0911)
stations_1214$elev_m <- extract(elev * .3048, stations_1214)
rm(elev)
detach("package:raster", unload=TRUE)
save.image("~/Documents/soco_ppt/spatial_201510.RData")



ppt_nov03.sp <- stations_0308[, c("station", "lat_utm", "lon_utm", "elev_m", "ppt_nov03")]
ppt_nov03.sp <- ppt_nov03.sp[!is.na(ppt_nov03.sp$ppt_nov03), ]
summary(ppt_nov03.sp)
ppt_nov03.sp@data
ppt_nov03.sp <- ppt_nov03.sp[ppt_nov03.sp$station != "fop", ]
ppt_nov03.sp@data

plot(ppt_nov03.sp, pch = 1, cex = sqrt(ppt_nov03.sp$ppt_nov03))

ppt_nov03.lm <- lm(ppt_nov03 ~ lat_utm, data = ppt_nov03.sp)
summary(ppt_nov03.lm)

max.dist <- 0.25 * max(iDist(ppt_nov03.sp@coords))
bins <- 50

vario_ppt_nov03 <- variog(coords = ppt_nov03.sp@coords, 
                          data = ppt_nov03.sp$ppt_nov03)
plot(vario_ppt_nov03)
str(vario_ppt_nov03)
mean(vario_ppt_nov03$v)

fit_ppt_nov03 <- variofit(vario_ppt_nov03,
                          ini.cov.pars = c(862, 1000) ,
                          cov.model = "exponential",
                          minimisation.function = "nls",
                          weights = "equal")

vario_ppt_nov03 <- variogram(ppt_nov03 ~ elev_m, data = ppt_nov03.sp,
                             # cutoff = max.dist, 
                             # width = 5
                             )
fit_ppt_nov03 <- fit.variogram(vario_ppt_nov03, vgm(psill = 1000, model = "Exp", 100/-log(.05), 600))

plot(vario_ppt_nov03, fit_ppt_nov03)
```



